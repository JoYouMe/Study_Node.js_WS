<link rel="stylesheet" type="text/css" href="./style.css">
<h1>👩‍💻👨‍💻</h1>
<pre id="messages" style="height: 400px; overflow: scroll;"></pre>
<input class="input" type="text" id="msgBox" placeholder="Type your msg here" />
<button class="btn" id="send" title="Send msg!">Send</button>

<script>
    (function(){
        const sendBtn = document.querySelector('#send');
        const messages = document.querySelector('#messages');
        const msgBox = document.querySelector('#msgBox');

        let ws;

        function showMsg(message) {
            messages.textContent += `\n\n${message}`;
            messages.scrollTop = messages.scrollHeight;
            msgBox.value = '';
        }

        function init(){
            if(ws){
                ws.onerror = ws.onopen = ws.onclose = null;
                ws.close();
            }

            ws = new WebSocket('ws://localhost:3003');
            ws.onopen = () => {
                console.log('Connection opended!');
            }
            ws.onmessage = ({data}) => showMsg(data);
            ws.onclose = function(){
                ws = null;
            }
        }

        sendBtn.onclick = function(){
            if(!ws){
                showMsg("No WebSocket connection 😞");
                return;
            }
            
            ws.send(msgBox.value);
            showMsg(msgBox.value);
        }

        init();
    })()
</script>